<html>
<head>
  <script src="https://cdn.firebase.com/js/client/1.0.15/firebase.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="src/jquery.hotkeys.js"></script>
  <script src="src/key_status.js"></script>
  <script src="src/util.js"></script>
  <script src="src/sprite.js"></script>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <!--script src="src/DerpyBird.js"></script>
  <script src="src/init.js"></script-->
</head>

<body class="bird-body example-base">
  <div>
    <canvas id="canvas" width="1000" height="600"></canvas>
  </div>
<!--   <input type="button" id="restartButton" value="Restart Game" class="hide" />
  <div id="gameInProgress">Game is in progress.  You will automatically join if either player leaves.</div> -->

<script>

  var canvas = $("#canvas").get(0);
  var context = canvas.getContext('2d');
  if (!canvas || !canvas.getContext || !canvas.getContext('2d'))
    alert("You must use a browser that supports HTML5 Canvas to run this game.");

  var CANVAS_HEIGHT = 600;
  var CANVAS_WIDTH = 1000;
  var FPS = 30;

  var playerOne = {
    color: "#00A",
    x: 100,
    y: CANVAS_HEIGHT / 2,
    width: 60,
    height: 60,
    draw: function() {
      canvas.fillRect(this.x, this.y, this.width, this.height);
    }
  };

  var playerOneBullets = [];
  // var playerTwoBullets = [];

  function OneBullet(I) {
    I.active = true;

    I.xVelocity = -I.speed;
    I.yVelocity = 0;
    I.width = 5;
    I.height = 5;
    I.color = "#000";

    I.inBounds = function() {
      return I.y >= 0 && I.y <= CANVAS_WIDTH && 
        I.x >= 0 && I.x <= CANVAS_WIDTH; 
    };

    I.sprite = Sprite("bullet1");

    I.draw = function() {
      this.sprite.draw(context, this.x, this.y);
    };

    I.update = function() {
      I.x -= I.xVelocity;
      I.y -= I.yVelocity;

      I.active = I.active && I.inBounds();
    };

    I.explode = function() {
      this.active = false;
    };

    return I;
  }

  setInterval(function() {
    update();
    draw();
  }, 1000/FPS);

  function update() {
    if (keydown.space) {
      playerOne.shoot();
    }
    if (keydown.left) {
      playerOne.x -= 5;
    }
    if (keydown.right) {
      playerOne.x += 5; 
    }
    if (keydown.up) {
      playerOne.y -= 5;
    }
    if (keydown.down) {
      playerOne.y += 5;
    }

    playerOne.x = playerOne.x.clamp(0, CANVAS_WIDTH / 2);
    playerOne.y = playerOne.y.clamp(0, CANVAS_HEIGHT - playerOne.height);

    playerOneBullets.forEach(function(bullet) {
      bullet.update();
    });

    playerOneBullets = playerOneBullets.filter(function(bullet) {
      return bullet.active;
    });

/*    powerUps.forEach(function(powerUp) {
      powerUp.update();
    });

    powerUps = powerUps.filter(function(powerUp) {
      return powerUp.active;
    });*/

    // handleCollisions();

  }

  playerOne.shoot = function() {
    // Sound.play("shoot");
    var bulletPosition = this.midPoint();

    playerOneBullets.push(OneBullet ({
      speed: 5,
      x: bulletPosition.x,
      y: bulletPosition.y
    }));
  };

  playerOne.midPoint = function () {
    return {
      x: this.x + this.width/2,
      y: this.y + this.height/2
    };
  };

  function draw() {
    context.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    playerOne.draw();
    // playerTwo.draw();

    playerOneBullets.forEach(function(bullet) {
      bullet.draw();
    });

/*    playerTwoBullets.forEach(function(bullet) {
      bullet.draw();
    });*/

/*    powerUps.forEach(function(powerUp) {
      powerUp.draw();
    });*/
  }

  function collides(a, b) {
    return a.x < b.x + b.width &&
    a.x + a.width > b.x &&
    a.y < b.y + b.height &&
    a.y + a.height > b.y;
  }

/*  function handleCollisions() {
    playerOneBullets.forEach(function(bullet) {
      if (collides(bullet, playerTwo) {
        playerTwo.explode();
        bullet.active = false;
      })
    });
    playerTwoBullets.forEach(function(bullet) {
      if (collides(bullet, playerOne) {
        playerOne.explode();
        bullet.active = false;
      })
    });
  }*/

  playerOne.explode = function() {
    this.active = false;
  };

  playerOne.sprite = Sprite("ship1");

  playerOne.draw = function() {
    this.sprite.draw(context, this.x, this.y);
  };

/*  playerTwo.explode = function() {
    this.active = false;
  };

  playerTwo.sprite = Sprite("player2");

  playerTwo.draw = function() {
    this.sprite.draw(context, this.x, this.y);
  };*/

</script>
</body>
</html>
